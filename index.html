<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Language Bridge</title>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #701b76; color: white; text-align: center; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; padding: 10px; }
        
        #webcam-container { 
            margin: 15px auto; 
            border: 8px solid #1b7576; 
            border-radius: 20px; 
            width: 250px; 
            height: 250px; 
            background-color: #000; 
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas { border-radius: 10px; width: 100% !important; height: auto !important; }

        #label-container { font-size: 24px; font-weight: bold; color: #f1c40f; margin: 15px 0; min-height: 40px; }
        
        .reply-box { background: #1b7576; padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        input { padding: 12px; width: 70%; border-radius: 5px; border: none; font-size: 16px; margin-bottom: 10px; }
        
        button { padding: 12px 25px; background: #283c47; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:active { transform: scale(0.95); }

        #switch-btn { background: #3498db; margin-bottom: 10px; width: 100%; max-width: 250px; }
        
        #signDisplay { display: none; margin: 20px auto; width: 280px; border-radius: 15px; border: 4px solid #f1c40f; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Sign Language Bridge ü§ù</h1>
        
        <div id="label-container">Loading Model... ‚åõ</div>
        
        <div id="webcam-container"></div>

        <button id="switch-btn" onclick="switchCamera()">üîÑ Switch Camera</button>

        <div class="reply-box">
            <h3>Text to Image</h3>
            <input type="text" id="ram-input" placeholder="Type a word...">
            <br>
            <button onclick="sendReply()">Show Sign</button>
        </div>

        <img id="signDisplay" src="" alt="Sign Image">
    </div>

    <script>
        // Teachable Machine URL
        const URL = "https://teachablemachine.withgoogle.com/models/XWj81Sbck/"; 
        
        let model, webcam, maxPredictions;
        // ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æ™‡Øá‡Æï‡Øç ‡Æï‡Øá‡ÆÆ‡Æ∞‡Ææ ‡ÆÜ‡Æ©‡Øç ‡ÆÜ‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æü‡Æø ‡Æö‡ØÜ‡Æü‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ
        let currentFacingMode = "environment"; 

        async function init() {
            try {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                await setupWebcam();
                window.requestAnimationFrame(loop);
            } catch (e) {
                document.getElementById("label-container").innerText = "Error loading model.";
            }
        }

        async function setupWebcam() {
            const flip = (currentFacingMode === "user"); 
            webcam = new tmImage.Webcam(250, 250, flip); 
            
            await webcam.setup({ facingMode: currentFacingMode }); 
            await webcam.play();

            const container = document.getElementById("webcam-container");
            container.innerHTML = ""; 
            container.appendChild(webcam.canvas);
        }

        // ‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Æø‡Æ≤‡Øç ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æï ‡Æµ‡Øá‡Æ≤‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü Switch Camera ‡Æ™‡Æô‡Øç‡Æï‡Øç‡Æ∑‡Æ©‡Øç
        async function switchCamera() {
            const label = document.getElementById("label-container");
            label.innerText = "Switching... üîÑ";

            if (webcam) {
                // ‡Æ™‡Æ¥‡Øà‡ÆØ ‡Æï‡Øá‡ÆÆ‡Æ∞‡Ææ ‡Æ∏‡Øç‡Æü‡Øç‡Æ∞‡ØÄ‡ÆÆ‡Øà ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æ§‡Æ≤‡Øç
                await webcam.stop();
                
                // ‡ÆÆ‡Øá‡Æ©‡ØÅ‡Æµ‡Æ≤‡Ææ‡Æï ‡Æï‡Øá‡ÆÆ‡Æ∞‡Ææ ‡Æü‡Æø‡Æ∞‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æ§‡Æ≤‡Øç (‡Æá‡Æ§‡ØÅ‡Æ§‡Ææ‡Æ©‡Øç ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Øç)
                if (webcam.canvas && webcam.canvas.srcObject) {
                    const tracks = webcam.canvas.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                }
            }

            // ‡ÆÆ‡Øã‡Æü‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡ØÅ‡Æ§‡Æ≤‡Øç
            currentFacingMode = (currentFacingMode === "user") ? "environment" : "user";
            
            // 500ms ‡Æ§‡Ææ‡ÆÆ‡Æ§‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æ™‡Æø‡Æ±‡Æï‡ØÅ ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æï‡Øá‡ÆÆ‡Æ∞‡Ææ‡Æµ‡Øà ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ‡Æ§‡Æ≤‡Øç
            setTimeout(async () => {
                try {
                    await setupWebcam();
                    label.innerText = "Ready! ‚úÖ";
                } catch (err) {
                    label.innerText = "Camera Error. Try Again.";
                    console.error(err);
                }
            }, 500);
        }

        async function loop() {
            webcam.update(); 
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            let bestPrediction = { className: "", probability: 0 };

            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > bestPrediction.probability) {
                    bestPrediction = prediction[i];
                }
            }

            const label = document.getElementById("label-container");
            if (bestPrediction.probability > 0.85) {
                label.innerText = "Sign: " + bestPrediction.className;
            } else {
                label.innerText = "Scanning...";
            }
        }

        function sendReply() {
            let inputText = document.getElementById("ram-input").value.toLowerCase().trim();
            let displayImage = document.getElementById("signDisplay");
            
            if (inputText === "") return;

            const extensions = ["jpg", "png", "jpeg", "webp"];
            let index = 0;

            displayImage.style.display = "block";

            function tryNext() {
                if (index < extensions.length) {
                    displayImage.src = "image/" + inputText + "." + extensions[index];
                    index++;
                } else {
                    alert("Image not found!");
                    displayImage.style.display = "none";
                }
            }

            displayImage.onerror = tryNext;
            tryNext();
        }

        init();
    </script>
</body>
</html>
