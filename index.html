<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Language Translator</title>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #701b76; color: white; text-align: center; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        /* Webcam Container Style */
        #webcam-container { 
            margin: 20px auto; 
            border: 8px solid #1b7576; 
            border-radius: 20px; 
            width: 250px; 
            height: 250px; 
            background-color: #000; 
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        canvas { border-radius: 10px; width: 100% !important; height: auto !important; }

        #label-container { font-size: 28px; font-weight: bold; color: #f1c40f; margin: 20px 0; min-height: 40px; }
        
        .reply-box { background: #1b7576; padding: 20px; border-radius: 15px; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        input { padding: 12px; width: 60%; border-radius: 5px; border: none; font-size: 16px; outline: none; }
        
        .btn-group { margin-top: 15px; }
        
        button { padding: 12px 25px; background: #283c47; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background: #013617; transform: scale(1.05); }

        #switch-btn { background: #3498db; margin-bottom: 15px; }
        
        #signDisplay { display: none; margin: 25px auto; width: 300px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 4px solid #f1c40f; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Sign Language Bridge ü§ù</h1>
        
        <div id="label-container">Initializing Camera... üé•</div>
        
        <div id="webcam-container"></div>

        <button id="switch-btn" onclick="switchCamera()">üîÑ Switch Camera</button>

        <div class="reply-box">
            <h3>Text to Sign Language</h3>
            <input type="text" id="ram-input" placeholder="Enter word (e.g. hello)">
            <button onclick="sendReply()">Show Sign</button>
        </div>

        <img id="signDisplay" src="" alt="Sign Language Image">
    </div>

    <script>
        // 1. Teachable Machine Model URL
        const URL = "https://teachablemachine.withgoogle.com/models/XWj81Sbck/"; 
        
        let model, webcam, maxPredictions;
        
        // ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡ÆÆ‡Øç: ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç 'environment' (Back Camera) ‡Æö‡ØÜ‡Æü‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ
        let currentFacingMode = "environment"; 

        // 2. Init Function - Start with Back Camera
        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // Load Model
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            await setupWebcam();
            window.requestAnimationFrame(loop);
        }

        // 3. Helper to setup or restart webcam
        async function setupWebcam() {
            // If webcam already exists, stop it
            if (webcam) {
                await webcam.stop();
            }

            // 'user' ‡Æé‡Æ©‡Øç‡Æ±‡Ææ‡Æ≤‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç Mirror/Flip ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡ÆÆ‡Øç
            const flip = (currentFacingMode === "user"); 
            
            webcam = new tmImage.Webcam(250, 250, flip); 
            await webcam.setup({ facingMode: currentFacingMode }); 
            await webcam.play();

            const container = document.getElementById("webcam-container");
            container.innerHTML = ""; // Clear existing canvas
            container.appendChild(webcam.canvas);
        }

        // 4. Switch Camera Logic (Toggle between User and Environment)
        async function switchCamera() {
            document.getElementById("label-container").innerText = "Switching Camera...";
            
            // Toggle Logic
            currentFacingMode = (currentFacingMode === "user") ? "environment" : "user";
            
            await setupWebcam();
        }

        async function loop() {
            webcam.update(); 
            await predict();
            window.requestAnimationFrame(loop);
        }

        // Prediction Logic
        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            let found = false;
            
            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > 0.90) {
                    document.getElementById("label-container").innerText = "Detected: " + prediction[i].className;
                    found = true;
                }
            }
            
            if (!found) {
                document.getElementById("label-container").innerText = "Scanning for signs...";
            }
        }

        // Text to Image Logic
        function sendReply() {
            let inputText = document.getElementById("ram-input").value.toLowerCase().trim();
            let displayImage = document.getElementById("signDisplay");
            
            if (inputText === "") {
                alert("Please enter some text!");
                return;
            }

            const extensions = ["jpg", "png", "jpeg", "webp"];
            let index = 0;

            function tryNextExtension() {
                if (index < extensions.length) {
                    displayImage.src = "image/" + inputText + "." + extensions[index];
                    index++;
                } else {
                    alert("Sorry, no image found for: " + inputText);
                    displayImage.style.display = "none";
                }
            }

            displayImage.style.display = "block";
            displayImage.onerror = tryNextExtension;
            tryNextExtension();
        }

        // Start the App
        init();
    </script>
</body>
</html>
